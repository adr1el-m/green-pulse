<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Footprint Prediction & Suggestions</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>

    <header>

    </header>


    <div class="container">
        <div class="form-wrapper">
            <h1 class="title">Carbon Footprint Prediction & Suggestions</h1>
            <p class="subtitle">Find out your carbon footprint and get eco-friendly suggestions!</p>
            
            <form id="carbon-form">
                <div class="form-group">
                    <label for="transportation">How do you commute?</label>
                    <select id="transportation">
                        <option value="car">Car</option>
                        <option value="public_transport">Public Transport</option>
                        <option value="bicycle">Bicycle</option>
                        <option value="walking">Walking</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="energyUsage">How much energy do you use monthly? (kWh)</label>
                    <input type="number" id="energyUsage" placeholder="Enter monthly energy usage" required>
                </div>

                <div class="form-group">
                    <label for="foodChoices">How often do you consume meat?</label>
                    <select id="foodChoices">
                        <option value="every_day">Every day</option>
                        <option value="few_times_a_week">Few times a week</option>
                        <option value="rarely">Rarely</option>
                        <option value="never">Never</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="receiptUpload">Upload Grocery Receipt or Barcode</label>
                    <input type="file" id="receiptUpload" accept="image/*">
                </div>

                <button type="submit">Get Carbon Footprint Suggestions</button>
            </form>

            <div id="response-container" class="hidden">
                <h3>Your Personalized Suggestions:</h3>
                <p id="response"></p>
            </div>

            <div id="image-response-container" class="hidden">
                <h3>Analysis Results:</h3>
                <p id="image-response"></p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('carbon-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const transportation = document.getElementById('transportation').value;
            const energyUsage = document.getElementById('energyUsage').value;
            const foodChoices = document.getElementById('foodChoices').value;
            const fileInput = document.getElementById('receiptUpload').files[0];

            const promptText = `Transportation: ${transportation}, Energy Usage: ${energyUsage} kWh/month, Food Choices: ${foodChoices}`;

            try {
                // Send text-based request first
                const textResponse = await fetch('http://localhost:5000/green-pulse', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ promptText }),
                });

                const textResult = await textResponse.json();
                console.log("API Response:", textResult);

                if (textResponse.ok && textResult?.suggestion) {
                    document.getElementById('response').innerHTML = textResult.suggestion || "No suggestions available.";
                    document.getElementById('response-container').classList.remove('hidden');
                } else {
                    console.error("Unexpected API response:", textResult);
                    document.getElementById('response').innerHTML = 'No valid suggestions received.';
                    document.getElementById('response-container').classList.remove('hidden');
                }

                // Handle image upload if provided
                if (fileInput) {
                    const formData = new FormData();
                    formData.append("image", fileInput);

                    const imageResponse = await fetch('http://localhost:5000/upload-image', {
                        method: 'POST',
                        body: formData
                    });

                    const imageResult = await imageResponse.json();
                    console.log("Image Analysis Response:", imageResult);

                    if (imageResponse.ok && imageResult?.suggestion) {
                        document.getElementById('image-response').innerHTML = imageResult.suggestion;
                        document.getElementById('image-response-container').classList.remove('hidden');
                    } else {
                        document.getElementById('image-response').innerHTML = 'No valid suggestions received.';
                        document.getElementById('image-response-container').classList.remove('hidden');
                    }
                }

            } catch (error) {
                console.error('Error processing request:', error);
                alert('Error fetching suggestions.');
            }
        });
    </script>
</body>
</html>
